transforms:
  # Pick a prototype Pcr register and apply it to all ports for all Pcr registers.
  # Some ports do not have some Pcr registers, but we will ignore that in the PAC and fix that in the HAL.
  - !Rename
    from: port0::regs::Pcr2
    to: port::regs::Pcr

  - !ModifyRegisters
    blocks: port(\d+)::Port(\d+)
    registers: pcr(\d+)
    fieldset: port::regs::Pcr

  - !DeleteFieldsets
    from: port(\d+)::regs::Pcr(\d+)

  # Roughly merge all port blocks together.
  - !MergeBlocks
    from: port(\d+)::Port(\d+)
    to: port0::Port0
    main: port0::Port0
    check: Layout

  - !Rename
    from: port0::(.*)
    to: port::$1
    type: All

  - !Rename
    from: port::Port0
    to: port::Port
    type: Block

  - !Delete
    from: port(\d+)::(.*)

    # Merge all Mux into the most capable variant of it with bitsize = 4.
    # Pcr 0, 1 and 7 have a smaller Mux set for ports 0 and 4.
    # In the HAL we will enforce this constraint, but for the PAC this only makes the types more complex.
  - !DeleteEnums
    from: port::vals::Pcr(\d+)Mux
    bit_size: 3
  - !MergeEnums
    from: port::vals::Pcr(\d+)Mux
    to: port::vals::Mux

  - !MergeEnums
    from: port::vals::Gpwe(\d+)
    to: port::vals::Gpwe

  - !MergeEnums
    from: port::vals::Pcr(\d+)Dse
    to: port::vals::Dse
  # - !MergeEnums
  #   from: port::vals::Pcr(\d+)Dse1
  #   to: port::vals::Dse1
  - !MergeEnums
    from: port::vals::Pcr(\d+)Sre
    to: port::vals::Sre
  # - !MergeEnums
  #   from: port::vals::Pcr(\d+)Pfe
  #   to: port::vals::Pfe
  - !MergeEnums
    from: port::vals::Pcr(\d+)Ibe
    to: port::vals::Ibe
  - !MergeEnums
    from: port::vals::Pcr(\d+)Inv
    to: port::vals::Inv
  - !MergeEnums
    from: port::vals::Pcr(\d+)Ode
    to: port::vals::Ode
  - !MergeEnums
    from: port::vals::Pcr(\d+)Pe
    to: port::vals::Pe
  - !MergeEnums
    from: port::vals::Pcr(\d+)Ps
    to: port::vals::Ps
  - !MergeEnums
    from: port::vals::Pcr(\d+)Lk
    to: port::vals::Lk

  # Delete uncommon fields that we will not expose in the HAL regardless.
  # In the future, you may consider re-adding them.
  - !DeleteFields
    fieldset: port::regs::Pcr(\d+)
    from: (dse1|pfe|pv)

  - !DeleteEnums
    from: port::vals::Pcr(\d+)(Dse1|Pfe)
  - !DeleteEnums
    from: port::vals::Pv

  - !MergeFieldsets
    from: port::regs::Pcr(\d+)
    to: port::regs::Pcr

  - !MakeRegisterArray
    blocks: port::Port
    from: pcr(\d+)
    to: pcr

  - !MakeFieldArray
    fieldsets: port::regs::Gpc(l|h)r
    from: gpwe(\d+)
    to: gpwe
